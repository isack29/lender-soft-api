# ğŸ—ï¸ Diagramas de Arquitectura - Servicio de Hash

## ğŸ“Š Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Browser   â”‚  â”‚   Mobile    â”‚  â”‚   Postman   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    PRESENTATION      â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚UserControllerâ”‚AuthControllerâ”‚               â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPLICATION         â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                â”‚
â”‚  â”‚  â”‚CreateUser   â”‚  â”‚ Login  â”‚â”‚                                â”‚
â”‚  â”‚  â”‚UpdateUser   â”‚  â”‚UseCase â”‚â”‚                                â”‚
â”‚  â”‚  â”‚GetUserById  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                â”‚
â”‚  â”‚  â”‚DeleteUser   â”‚            â”‚                                â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                                â”‚
â”‚  â”‚         â”‚                   â”‚                                â”‚
â”‚  â”‚         â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€IHashService                    â”‚
â”‚  â”‚         â”‚                   â”‚                                â”‚
â”‚  â”‚         â–¼                   â”‚                                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                                â”‚
â”‚  â”‚  â”‚IUserRepo    â”‚            â”‚                                â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DOMAIN   â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  IUserRepository     â”‚     â”‚  IHashService    â”‚              â”‚
â”‚  â”‚    (Interface)       â”‚     â”‚   (Interface)    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         Contratos de Dominio                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚INFRASTRUCTUREâ”‚                         â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  UserRepository      â”‚   â”‚  BcryptService      â”‚            â”‚
â”‚  â”‚  (Prisma)            â”‚   â”‚  (bcrypt library)   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   PostgreSQL    â”‚
    â”‚    Database     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flujo de Registro de Usuario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      
â”‚ Cliente â”‚                                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                      
     â”‚                                                           
     â”‚ POST /users                                               
     â”‚ {                                                         
     â”‚   "email": "user@example.com",                           
     â”‚   "password": "PlainText123!"                            
     â”‚ }                                                         
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ UserController  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ createUser(dto)                                          
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         
â”‚ CreateUserUseCase   â”‚                                         
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         
     â”‚                                                           
     â”‚ 1. Validar duplicados                                    
     â”‚ âœ“ Email Ãºnico                                            
     â”‚ âœ“ Phone Ãºnico                                            
     â”‚ âœ“ Document Ãºnico                                         
     â”‚                                                           
     â–¼                                                           
     â”‚ 2. hashPassword("PlainText123!")                         
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ BcryptService   â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ bcrypt.hash()                                            
     â”‚ - Genera salt Ãºnico                                      
     â”‚ - Aplica 10 rounds                                       
     â”‚ - Retorna hash                                           
     â”‚                                                           
     â–¼                                                           
     "$2b$10$xxxxxxxxxxxxxxxxxxxxxxxxxxx" â† Hash generado
     â”‚                                                           
     â”‚ 3. createUser({...dto, password: hash})                  
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ UserRepository  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ prisma.user.create()                                     
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚  PostgreSQL  â”‚                                                
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                
â”‚  â”‚ User   â”‚  â”‚                                                
â”‚  â”‚ â”œâ”€ id  â”‚  â”‚                                                
â”‚  â”‚ â”œâ”€ ... â”‚  â”‚                                                
â”‚  â”‚ â””â”€ pwd â”‚  â”‚ â† "$2b$10$xxx..." (hasheado)                 
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                
       â”‚                                                         
       â”‚ User object                                            
       â–¼                                                         
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ UserController  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ toUserResponse(user) â† Elimina password                 
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 
â”‚   Cliente   â”‚                                                 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 
     â–²                                                           
     â”‚                                                           
     â”‚ {                                                         
     â”‚   "success": true,                                       
     â”‚   "info": "User created successfully",                   
     â”‚   "data": {                                              
     â”‚     "id": "uuid",                                        
     â”‚     "email": "user@example.com",                         
     â”‚     // âŒ NO incluye password                            
     â”‚   }                                                       
     â”‚ }                                                         
```

## ğŸ” Flujo de Login

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      
â”‚ Cliente â”‚                                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                      
     â”‚                                                           
     â”‚ POST /auth/login                                         
     â”‚ {                                                         
     â”‚   "email": "user@example.com",                           
     â”‚   "password": "PlainText123!"                            
     â”‚ }                                                         
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ AuthController  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ login(dto)                                               
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚ LoginUseCase â”‚                                                
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                
     â”‚                                                           
     â”‚ 1. findUserByEmail()                                     
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ UserRepository  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚  PostgreSQL  â”‚                                                
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                
       â”‚                                                         
       â”‚ User {                                                 
       â”‚   id: "uuid",                                          
       â”‚   email: "user@example.com",                           
       â”‚   password: "$2b$10$xxx...", â† Hash de BD             
       â”‚   ...                                                  
       â”‚ }                                                       
       â”‚                                                         
       â–¼                                                         
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚ LoginUseCase â”‚                                                
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                
     â”‚                                                           
     â”‚ 2. Â¿Usuario existe?                                      
     â”‚ âœ“ Si â†’ Continuar                                         
     â”‚ âœ— No â†’ 401 Unauthorized                                  
     â”‚                                                           
     â”‚ 3. Â¿Usuario activo?                                      
     â”‚ âœ“ deleted === false â†’ Continuar                          
     â”‚ âœ— deleted === true â†’ 401 Unauthorized                    
     â”‚                                                           
     â”‚ 4. comparePassword(                                      
     â”‚      "PlainText123!",        â† Password del cliente     
     â”‚      "$2b$10$xxx..."         â† Hash de BD               
     â”‚    )                                                      
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ BcryptService   â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ bcrypt.compare()                                         
     â”‚                                                           
     â”‚ Proceso:                                                 
     â”‚ 1. Extrae salt del hash                                  
     â”‚ 2. Hashea password con ese salt                          
     â”‚ 3. Compara hashes                                        
     â”‚                                                           
     â–¼                                                           
     true/false                                                  
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚ LoginUseCase â”‚                                                
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                
     â”‚                                                           
     â”‚ 5. Â¿Password vÃ¡lido?                                     
     â”‚ âœ“ true â†’ Continuar                                       
     â”‚ âœ— false â†’ 401 Unauthorized                               
     â”‚                                                           
     â”‚ 6. jwtService.sign({                                     
     â”‚      sub: user.id,                                       
     â”‚      email: user.email,                                  
     â”‚      role: user.role                                     
     â”‚    })                                                     
     â”‚                                                           
     â–¼                                                           
     "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxx" â† JWT Token    
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ AuthController  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 
â”‚   Cliente   â”‚                                                 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 
     â–²                                                           
     â”‚                                                           
     â”‚ {                                                         
     â”‚   "success": true,                                       
     â”‚   "info": "Login successful",                            
     â”‚   "data": {                                              
     â”‚     "accessToken": "eyJhbG...",                          
     â”‚     "user": {                                            
     â”‚       "id": "uuid",                                      
     â”‚       "email": "user@example.com",                       
     â”‚       // âŒ NO incluye password                          
     â”‚     }                                                     
     â”‚   }                                                       
     â”‚ }                                                         
```

## ğŸ”§ Flujo de ActualizaciÃ³n de ContraseÃ±a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      
â”‚ Cliente â”‚                                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                      
     â”‚                                                           
     â”‚ PATCH /users/:id                                         
     â”‚ Authorization: Bearer eyJhbG...                          
     â”‚ {                                                         
     â”‚   "password": "NewPassword456!"                          
     â”‚ }                                                         
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ UserController  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ updateUser(id, dto)                                      
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         
â”‚ UpdateUserUseCase   â”‚                                         
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         
     â”‚                                                           
     â”‚ 1. findById(id)                                          
     â”‚ âœ“ Usuario existe â†’ Continuar                             
     â”‚ âœ— No existe â†’ 404 Not Found                              
     â”‚                                                           
     â”‚ 2. Â¿Hay password en dto?                                 
     â”‚                                                           
     â–¼                                                           
     if (dto.password) {                                        
        â”‚                                                        
        â”‚ hashPassword("NewPassword456!")                       
        â–¼                                                        
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        
     â”‚ BcryptService   â”‚                                        
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        
          â”‚                                                      
          â”‚ bcrypt.hash()                                       
          â”‚ - Nuevo salt Ãºnico                                  
          â”‚ - 10 rounds                                         
          â”‚                                                      
          â–¼                                                      
          "$2b$10$yyyyyyyyyyyyyyyyyyyyyyyy" â† Nuevo hash        
          â”‚                                                      
     }                                                           
     â”‚                                                           
     â”‚ 3. updateUser(id, {...dto, password: newHash})          
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ UserRepository  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ prisma.user.update()                                     
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚  PostgreSQL  â”‚                                                
â”‚  User        â”‚                                                
â”‚  â””â”€ pwd â†’ "$2b$10$yyy..." â† Nuevo hash guardado             
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                
       â”‚                                                         
       â–¼                                                         
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ UserController  â”‚                                             
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
     â”‚                                                           
     â”‚ toUserResponse(user)                                     
     â”‚                                                           
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 
â”‚   Cliente   â”‚                                                 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 
     â–²                                                           
     â”‚                                                           
     â”‚ {                                                         
     â”‚   "success": true,                                       
     â”‚   "info": "User updated successfully",                   
     â”‚   "data": {                                              
     â”‚     // Usuario actualizado sin password                  
     â”‚   }                                                       
     â”‚ }                                                         
```

## ğŸ”’ CÃ³mo Funciona Bcrypt

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HASH DE CONTRASEÃ‘A                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: "MyPassword123!"

     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Generar     â”‚
â”‚     Salt        â”‚  â† Aleatorio y Ãºnico
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Salt: "$2b$10$XxXxXxXxXxXxXxXxXxXxXx"
     â”‚       â””â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚         â”‚      â”‚             â”‚
     â”‚    Algoritmo  Cost    Salt (22 chars)
     â”‚      (2b)    (2^10)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Hash con    â”‚
â”‚     Salt        â”‚  â† 1024 iteraciones (2^10)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Combinar    â”‚
â”‚     Todo        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼

Output: "$2b$10$XxXxXxXxXxXxXxXxXxXxXxYyYyYyYyYyYyYyYyYyYyYy"
        â””â”€â”¬â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚      â”‚             â”‚                   â”‚
      Algoritmo Cost         Salt              Hash (31 chars)

Longitud total: 60 caracteres

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMPARACIÃ“N DE CONTRASEÃ‘A                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input 1: "MyPassword123!" â† Del usuario (login)
Input 2: "$2b$10$XxXx...YyYy" â† De la BD (hash guardado)

     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Extraer     â”‚
â”‚     Salt        â”‚  â† Del hash guardado
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Salt: "$2b$10$XxXxXxXxXxXxXxXxXxXxXx"
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Hash input  â”‚
â”‚     con Salt    â”‚  â† Mismo proceso que al crear
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Nuevo Hash: "$2b$10$XxXx...ZzZz"
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Comparar    â”‚
â”‚     Hashes      â”‚  â† Timing-safe comparison
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼

Â¿Hashes idÃ©nticos?
â”œâ”€ âœ“ Yes â†’ return true  â†’ Login exitoso
â””â”€ âœ— No  â†’ return false â†’ Login fallido
```

## ğŸ›¡ï¸ Seguridad en Capas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NIVELES DE SEGURIDAD                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. TRANSPORTE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   HTTPS/TLS 1.3      â”‚  â† Encripta datos en trÃ¡nsito
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. APLICACIÃ“N
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ValidaciÃ³n de DTO   â”‚  â† Valida formato y fortaleza
   â”‚  - MinLength         â”‚
   â”‚  - Regex patterns    â”‚
   â”‚  - Custom validators â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. AUTENTICACIÃ“N
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   JWT Token          â”‚  â† AutenticaciÃ³n stateless
   â”‚   - 1 hora expiraciÃ³nâ”‚
   â”‚   - Role-based       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. HASHING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Bcrypt             â”‚  â† Hash irreversible
   â”‚   - Salt automÃ¡tico  â”‚
   â”‚   - 10 rounds        â”‚
   â”‚   - Timing-safe      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. BASE DE DATOS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   PostgreSQL         â”‚  â† Solo hashes, nunca plaintext
   â”‚   - Encrypted at restâ”‚
   â”‚   - Access controls  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. RESPUESTAS HTTP
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Sin Passwords      â”‚  â† Nunca expone contraseÃ±as
   â”‚   - toUserResponse() â”‚
   â”‚   - Omit<User, 'pwd'>â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

7. AUDITORÃA
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Logging            â”‚  â† Registra intentos fallidos
   â”‚   - Login attempts   â”‚
   â”‚   - Password changes â”‚
   â”‚   (sin registrar pwd)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ InyecciÃ³n de Dependencias

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APP MODULE                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  imports: [                                       â”‚ â”‚
â”‚  â”‚    ConfigModule,                                  â”‚ â”‚
â”‚  â”‚    HashModule,    â† @Global()                    â”‚ â”‚
â”‚  â”‚    UserModule,                                    â”‚ â”‚
â”‚  â”‚    AuthModule                                     â”‚ â”‚
â”‚  â”‚  ]                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User    â”‚   â”‚ Auth    â”‚   â”‚ Hash    â”‚
    â”‚ Module  â”‚   â”‚ Module  â”‚   â”‚ Module  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚             â”‚              â”‚
         â”‚             â”‚              â”‚
         â”‚  Providers  â”‚              â”‚ @Global
         â”‚             â”‚              â”‚ Provider
         â–¼             â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   'IUserRepository' â†’ UserRepo      â”‚
    â”‚   'IHashService'    â†’ BcryptService â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Injectable
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     â”‚
          â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Use      â”‚         â”‚ Use      â”‚
    â”‚ Cases    â”‚         â”‚ Cases    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    @Inject('IHashService')
```

## ğŸ¯ Resumen Visual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Password: "MySecret123!" (plaintext)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ HashService.hashPassword()
              â”‚ (bcrypt con 10 rounds)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hash: "$2b$10$XxXx...YyYy" (60 chars)                  â”‚
â”‚        âœ“ Irreversible                                   â”‚
â”‚        âœ“ Ãšnico (salt aleatorio)                         â”‚
â”‚        âœ“ Seguro (1024 iteraciones)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Guardar en BD
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL: users.password                             â”‚
â”‚  âŒ "MySecret123!" â† NUNCA                              â”‚
â”‚  âœ… "$2b$10$XxXx...YyYy" â† SIEMPRE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Login con "MySecret123!"
              â”‚
              â”‚ HashService.comparePassword()
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ComparaciÃ³n:                                           â”‚
â”‚  Input:  "MySecret123!"                                 â”‚
â”‚  Stored: "$2b$10$XxXx...YyYy"                           â”‚
â”‚                                                          â”‚
â”‚  1. Extraer salt del hash                               â”‚
â”‚  2. Hash input con mismo salt                           â”‚
â”‚  3. Comparar resultados                                 â”‚
â”‚                                                          â”‚
â”‚  Result: true/false                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ‰ Sistema completo, seguro y profesional!**

